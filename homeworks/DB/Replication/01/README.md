# Домашнее задание к занятию «Репликация и масштабирование. Часть 1»  - Винцентини С.Г.

### Задание 1

На лекции рассматривались режимы репликации master-slave, master-master, опишите их различия.

---
Master-Slave репликация - это простая и надёжная схема, где только один master сервер принимает запись, а остальные slaves сервера копируют его данные и отвечают за чтение. Это отлично подходит для масштабирования нагрузки на чтение, резервного копирования и базовой отказоустойчивости. Однако запись остаётся узким местом, а при падении master’а требуется failover.
Master-Master репликация - оба сервера могут и читать, и писать, автоматически синхронизируя изменения друг с другом. Это даёт высокую доступность и распределение нагрузки на запись, но сильно усложняет систему: возможны конфликты данных, циклы репликации и расхождения, если что-то пойдёт не так. Такая схема требует тщательной настройки и поддержки со стороны СУБД.
В итоге: master-slave - про простоту и стабильность, master-master - про гибкость и отказоустойчивость ценой сложности.

---

### Задание 2

Выполните конфигурацию master-slave репликации, примером можно пользоваться из лекции.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

---
Рассмотрим пример развертывания 2-ух монолитных инстансов PostgreSQL,

vbox1 - 192.168.1.3 - master нода

vbox2 - 192.168.1.10 - slave нода

#### Действия на мастере
Для начала установим PostgreSQL 
```bash
sudo apt update
sudo apt install postgresql
```
Подключмся и создадим пользователя *replicator*
```bash
sudo -u postgres psql
```
```sql
CREATE USER replicator WITH REPLICATION ENCRYPTED PASSWORD 'replicapass';
\q
```
Отредактируем конфигурационный файл по пути */etc/postgresql/16/main/postgresql.conf*:
```
# Разрешить подключения со всех адресов
listen_addresses = '*'
# Уровень WAL — обязательно replica
wal_level = replica
# Макс. число отправщиков WAL
max_wal_senders = 3
# Макс. число одновременных подключений
max_connections = 100
# Включить горячий standby на реплике
hot_standby = on
```
Отредактируем конфигурационный файл по пути */etc/postgresql/16/main/pg_hba.conf*, добавив в конец:
```
host    replication     replicator      192.168.1.10/32         md5
```
Перезапустим сервис postgresql и проверим его статус
```bash
sudo systemctl restart postgresql
sudo systemctl status postgresql
```
#### Действия на слэйве
Установим PostgreSQL, перед этим маскировав сервис (нам не нужен автоматический запуск)
```bash
sudo systemctl mask postgresql
sudo apt update
sudo apt install postgresql
sudo systemctl unmask postgresql
```

